<!DOCTYPE html>
<html lang='en'>
<head>
  <meta charset='UTF-8'>
  <title>Socket testing</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<!--  <script src="https://cdn.jsdelivr.net/npm/socket.io-client@2.4.0/dist/socket.io.dev.js"></script>-->
  <script src="http://localhost:3001/websockets/socket.io.js"></script>
</head>
<body>
<div id='v-app'>
  <h1>{{title}}</h1>
  <form>
    <label for='requestText'>Request text</label>
    <input id='requestText' type='text' v-model='text'>
    <button type='submit' @click.prevent='sendMessage()'>Send request</button>
    <p>
    <ul>
      <li v-for='msg of messages'>{{ msg }}</li>
    </ul>
    </p>
  </form>
</div>
</body>
<script>
  const app = new Vue({
    el: '#v-app',
    data: {
      title: 'Websocket Tester',
      text: '',
      messages: [],
      socket: null
    },
    methods: {
      sendMessage () {
        console.log(`send: ${this.text}`);
        this.socket.emit('msgToServer', this.text);
        this.text = '';
      },
      receiveMessage (msg) {
        console.log(`receive: ${msg}`);
        this.messages.push(msg);
      }
    },
    created () {
      this.socket = io('http://localhost:3001', { transports: ['websocket'], path: "/websockets" });
      this.socket.on('msgToClient', msg => {
        this.receiveMessage(msg);
      });
    }
  });
</script>
</html>
